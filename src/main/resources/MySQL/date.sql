-- 使用TFS数据库
USE TriageFlowSystem;

-- 清空现有数据（可选，如果需要重新初始化）
-- SET FOREIGN_KEY_CHECKS = 0;
-- TRUNCATE TABLE medical_exams;
-- TRUNCATE TABLE medical_devices;
-- TRUNCATE TABLE device_exam_capabilities;
-- TRUNCATE TABLE device_working_schedules;
-- TRUNCATE TABLE exam_prerequisites;
-- SET FOREIGN_KEY_CHECKS = 1;

-- 插入检查项目数据
INSERT INTO `medical_exams` (`exam_name`, `requires_fasting`) VALUES
                                                                  ('胸部CT', FALSE),
                                                                  ('腹部CT', TRUE),
                                                                  ('头部CT', FALSE),
                                                                  ('心脏B超', FALSE),
                                                                  ('腹部B超', TRUE),
                                                                  ('妇科B超', FALSE),
                                                                  ('抽血化验', TRUE),
                                                                  ('血糖检测', TRUE),
                                                                  ('肝功能检查', TRUE),
                                                                  ('肾功能检查', TRUE),
                                                                  ('血常规', TRUE),
                                                                  ('尿常规', FALSE),
                                                                  ('心电图', FALSE),
                                                                  ('身高体重测量', FALSE),
                                                                  ('血压测量', FALSE),
                                                                  ('视力检查', FALSE),
                                                                  ('听力检查', FALSE),
                                                                  ('骨密度检测', FALSE),
                                                                  ('胃镜检查', TRUE),
                                                                  ('肠镜检查', TRUE);

-- 插入医疗设备数据
INSERT INTO `medical_devices` (`device_name`, `quantity`, `location`) VALUES
                                                                          ('CT机-1', 1, '一楼影像科-CT室1'),
                                                                          ('CT机-2', 1, '一楼影像科-CT室2'),
                                                                          ('B超机-1', 1, '二楼超声科-检查室1'),
                                                                          ('B超机-2', 1, '二楼超声科-检查室2'),
                                                                          ('抽血工作站-1', 1, '三楼检验科-抽血站1'),
                                                                          ('抽血工作站-2', 1, '三楼检验科-抽血站2'),
                                                                          ('抽血工作站-3', 1, '三楼检验科-抽血站3'),
                                                                          ('身高体重仪', 2, '一楼体检中心-测量区'),
                                                                          ('心电图机', 2, '四楼心内科-检查室'),
                                                                          ('血压计', 5, '各科室血压测量点'),
                                                                          ('视力检查仪', 2, '五楼眼科-检查室'),
                                                                          ('听力检查仪', 1, '五楼耳鼻喉科-检查室'),
                                                                          ('骨密度仪', 1, '六楼骨科-检查室'),
                                                                          ('胃镜设备', 1, '三楼内镜中心-胃镜室'),
                                                                          ('肠镜设备', 1, '三楼内镜中心-肠镜室');

-- 插入设备检查能力数据（设备与检查项目的关联及检查时间）
INSERT INTO `device_exam_capabilities` (`device_id`, `exam_id`, `duration_minutes`) VALUES
-- CT机相关检查
(1, 1, 15), (1, 2, 20), (1, 3, 15),  -- CT机-1
(2, 1, 12), (2, 2, 18), (2, 3, 12),  -- CT机-2（新型号，时间更短）

-- B超机相关检查
(3, 4, 25), (3, 5, 30), (3, 6, 20),  -- B超机-1
(4, 4, 20), (4, 5, 25), (4, 6, 18),  -- B超机-2（新型号）

-- 抽血工作站
(5, 7, 3), (5, 8, 2), (5, 9, 4), (5, 10, 4), (5, 11, 3),
(6, 7, 3), (6, 8, 2), (6, 9, 4), (6, 10, 4), (6, 11, 3),
(7, 7, 3), (7, 8, 2), (7, 9, 4), (7, 10, 4), (7, 11, 3),

-- 身高体重仪
(8, 14, 2),

-- 心电图机
(9, 13, 10),

-- 血压计
(10, 15, 2),

-- 视力检查仪
(11, 16, 5),

-- 听力检查仪
(12, 17, 8),

-- 骨密度仪
(13, 18, 15),

-- 胃镜设备
(14, 19, 30),

-- 肠镜设备
(15, 20, 45);

-- 插入设备工作时间安排（周一至周五的工作时间）
INSERT INTO `device_working_schedules` (`device_id`, `day_of_week`, `start_time`, `end_time`) VALUES
-- CT机工作时间（周一至周五全天）
(1, 1, '08:00:00', '17:00:00'), (1, 2, '08:00:00', '17:00:00'),
(1, 3, '08:00:00', '17:00:00'), (1, 4, '08:00:00', '17:00:00'),
(1, 5, '08:00:00', '17:00:00'),
(2, 1, '08:00:00', '17:00:00'), (2, 2, '08:00:00', '17:00:00'),
(2, 3, '08:00:00', '17:00:00'), (2, 4, '08:00:00', '17:00:00'),
(2, 5, '08:00:00', '17:00:00'),

-- B超机工作时间
(3, 1, '08:00:00', '17:00:00'), (3, 2, '08:00:00', '17:00:00'),
(3, 3, '08:00:00', '17:00:00'), (3, 4, '08:00:00', '17:00:00'),
(3, 5, '08:00:00', '17:00:00'),
(4, 1, '08:00:00', '17:00:00'), (4, 2, '08:00:00', '17:00:00'),
(4, 3, '08:00:00', '17:00:00'), (4, 4, '08:00:00', '17:00:00'),
(4, 5, '08:00:00', '17:00:00'),

-- 抽血工作站（提前开始，照顾空腹患者）
(5, 1, '07:30:00', '16:30:00'), (5, 2, '07:30:00', '16:30:00'),
(5, 3, '07:30:00', '16:30:00'), (5, 4, '07:30:00', '16:30:00'),
(5, 5, '07:30:00', '16:30:00'),
(6, 1, '07:30:00', '16:30:00'), (6, 2, '07:30:00', '16:30:00'),
(6, 3, '07:30:00', '16:30:00'), (6, 4, '07:30:00', '16:30:00'),
(6, 5, '07:30:00', '16:30:00'),
(7, 1, '07:30:00', '16:30:00'), (7, 2, '07:30:00', '16:30:00'),
(7, 3, '07:30:00', '16:30:00'), (7, 4, '07:30:00', '16:30:00'),
(7, 5, '07:30:00', '16:30:00'),

-- 其他设备工作时间
(8, 1, '08:00:00', '17:00:00'), (8, 2, '08:00:00', '17:00:00'),
(8, 3, '08:00:00', '17:00:00'), (8, 4, '08:00:00', '17:00:00'),
(8, 5, '08:00:00', '17:00:00'),
(9, 1, '08:00:00', '17:00:00'), (9, 2, '08:00:00', '17:00:00'),
(9, 3, '08:00:00', '17:00:00'), (9, 4, '08:00:00', '17:00:00'),
(9, 5, '08:00:00', '17:00:00'),
(10, 1, '08:00:00', '17:00:00'), (10, 2, '08:00:00', '17:00:00'),
(10, 3, '08:00:00', '17:00:00'), (10, 4, '08:00:00', '17:00:00'),
(10, 5, '08:00:00', '17:00:00');

-- 插入检查项目前置约束
INSERT INTO `exam_prerequisites` (`exam_id`, `prerequisite_exam_id`) VALUES
-- 腹部B超前需要完成抽血
(5, 7),
-- 胃镜检查前需要完成心电图和抽血
(19, 13), (19, 7),
-- 肠镜检查前需要完成心电图和抽血
(20, 13), (20, 7),
-- 某些特殊检查可能需要基础检查
(9, 7),  -- 肝功能检查需要先抽血
(10, 7); -- 肾功能检查需要先抽血

-- 初始化设备实时状态
INSERT INTO `device_real_time_status` (`device_id`, `status`, `queue_count`, `utilization_rate`) VALUES
                                                                                                     (1, 'Idle', 0, 0.00), (2, 'Idle', 0, 0.00),
                                                                                                     (3, 'Idle', 0, 0.00), (4, 'Idle', 0, 0.00),
                                                                                                     (5, 'Idle', 0, 0.00), (6, 'Idle', 0, 0.00),
                                                                                                     (7, 'Idle', 0, 0.00), (8, 'Idle', 0, 0.00),
                                                                                                     (9, 'Idle', 0, 0.00), (10, 'Idle', 0, 0.00),
                                                                                                     (11, 'Idle', 0, 0.00), (12, 'Idle', 0, 0.00),
                                                                                                     (13, 'Idle', 0, 0.00), (14, 'Idle', 0, 0.00),
                                                                                                     (15, 'Idle', 0, 0.00);